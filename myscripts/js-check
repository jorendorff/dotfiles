#!/bin/bash

set -e
set -u

if [ -f ./dist/bin/js ]; then
    OBJDIR=`pwd`
    SRCDIR=`dirname "$OBJDIR"`
else
    SRCDIR=`hg root`/js/src
    OBJDIR=$SRCDIR/od-obj
fi

BINDIR="$OBJDIR"
if [ -d "$BINDIR/js" ]; then
    BINDIR="$BINDIR/dist/bin"
fi
JS="$BINDIR/js"

if [ $# == 0 ]; then
    "$BINDIR/jsapi-tests"
fi

cd "$SRCDIR/jit-test"
echo "running jit-test"
python jit_test.py -f --no-slow "$JS" $@ || echo "FAIL FAIL FAIL"

cd "$SRCDIR/tests"
echo "running js-tests"
python jstests.py -j8 "$JS" $@
